(this["webpackJsonprealtime-chat-app"]=this["webpackJsonprealtime-chat-app"]||[]).push([[0],{50:function(e,t,a){},51:function(e,t,a){},53:function(e,t,a){},62:function(e,t,a){},63:function(e,t,a){},64:function(e,t,a){},65:function(e,t,a){},66:function(e,t,a){},67:function(e,t,a){},68:function(e,t,a){},69:function(e,t,a){"use strict";a.r(t);var c=a(2),n=a(3),r=a.n(n),s=a(28),i=a.n(s),o=(a(50),a(51),a(18)),l=a(9),u=a(5),d=a(8),j=a.n(d),b=a(14),h=a(20),p=(a(53),a(11)),O=a(35);a(58),a(70);O.a.initializeApp({apiKey:"AIzaSyDhWHYUo31EhafDtO8OdAlDZthmVN85TPI",authDomain:"realtime-chat-ap.firebaseapp.com",projectId:"realtime-chat-ap",storageBucket:"realtime-chat-ap.appspot.com",messagingSenderId:"930254441751",appId:"1:930254441751:web:c256a9a83d26e7af4d7b52",measurementId:"G-8Q95J2GC5R"});var m=O.a,f="USER_LOGIN",v="USER_LOGOUT",x="GET_REALTIME_USERS",N="UPDATE_MESSAGE",S="GET_REALTIME_MESSAGE",g="SET_SEEN_MESSAGE",y="GET_LOADMORE_MESSAGE",E=function(e){return function(){var t=Object(b.a)(j.a.mark((function t(a){var c;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:c=m.firestore(),a({type:"".concat(f,"_REQUEST")}),m.auth().createUserWithEmailAndPassword(e.email,e.password).then((function(t){var n=m.auth().currentUser,r="".concat(e.firstName," ").concat(e.lastName);n.updateProfile({displayName:r}).then((function(){c.collection("users").doc(t.user.uid).set({firstName:e.firstName,lastName:e.lastName,createdAt:new Date,uid:t.user.uid,isOnline:!0}).then((function(){var c={firstName:e.firstName,lastName:e.lastName,uid:t.user.uid,email:e.email};localStorage.setItem("user",JSON.stringify({loggedUser:c})),a({type:"".concat(f,"_SUCCESS"),payload:{user:c}})})).catch((function(e){a({type:"".concat(f,"_FAILURE"),payload:e})}))}))})).catch((function(e){a({type:"".concat(f,"_FAILURE"),payload:{error:e.message}})}));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()};function _(){var e=Object(p.c)((function(e){return e.auth})),t=Object(p.b)();return Object(c.jsx)("div",{className:"header",children:Object(c.jsxs)("div",{className:"navBar",children:[Object(c.jsx)("div",{className:"navSide",children:Object(c.jsxs)("ul",{className:"navWrap",children:[Object(c.jsx)("li",{className:"navItem",children:Object(c.jsx)(o.c,{to:"/",className:"navLink",children:"HOME"})}),Object(c.jsx)("li",{className:"navItem",children:Object(c.jsx)(o.c,{to:"/about",className:"navLink",children:"ABOUT"})})]})}),Object(c.jsx)("div",{className:"logoArea",children:Object(c.jsx)("img",{src:"https://www.williamdollace.it/wp-content/themes/williamdollacetheme/images/logo.svg"})}),Object(c.jsx)("div",{className:"navSide",children:e.authenticated?Object(c.jsxs)("ul",{className:"navWrap",children:[Object(c.jsx)("li",{className:"navItem",children:Object(c.jsxs)(o.c,{to:"/profile",className:"navLink",children:[e.firstName," PROFILE"]})}),Object(c.jsx)("li",{className:"navItem",children:Object(c.jsx)(o.b,{to:"#",onClick:function(){var a;t((a=e.uid,function(){var e=Object(b.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t({type:"".concat(v,"_REQUEST")}),m.firestore().collection("users").doc(a).update({isOnline:!1}).then((function(){m.auth().signOut().then((function(){localStorage.clear(),t({type:"".concat(v,"_SUCCESS")})})).catch((function(e){t({type:"".concat(v,"_FAILURE"),payload:{error:e}})}))}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()))},className:"navLink",children:"LOG OUT"})})]}):Object(c.jsxs)("ul",{className:"navWrap",children:[Object(c.jsx)("li",{className:"navItem",children:Object(c.jsx)(o.c,{to:"/login",className:"navLink",children:"LOGIN"})}),Object(c.jsx)("li",{className:"navItem",children:Object(c.jsx)(o.c,{to:"/signup",className:"navLink",children:"SIGN UP"})})]})})]})})}function w(e){return Object(c.jsxs)("div",{className:"layout",children:[Object(c.jsx)(_,{}),e.children]})}a(62);function U(e){var t=e.value,a=e.type,r=e.label,s=e.onChange,i=e.placeholder,o=Object(n.useState)("inputGroup"),l=Object(h.a)(o,2),u=l[0],d=l[1];return Object(c.jsxs)("div",{className:u,children:[Object(c.jsx)("label",{children:r}),Object(c.jsx)("input",{type:a,onFocus:function(e){d("inputGroup onFocus")},onChange:function(e){var t=e.target.value;s(t)},placeholder:i,value:t}),Object(c.jsx)("div",{className:"line"})]})}a(63);function C(e){return Object(c.jsx)("div",{className:"card",children:e.children})}a(64);function A(e){return Object(c.jsx)("button",{type:e.type,className:"buttonGold",children:e.children})}a(65);function I(e){return Object(c.jsx)("div",{className:"title",children:Object(c.jsx)("p",{children:e.children})})}a(66);var L=a(31),R=function(e){return Object(c.jsxs)("div",{className:"error",children:[Object(c.jsx)("p",{children:e.children}),Object(c.jsx)(L.a,{className:"icon"})]})};function T(){var e=Object(p.b)(),t=Object(p.c)((function(e){return e.auth})),a=Object(n.useState)({email:"",password:"",firstName:"",lastName:""}),r=Object(h.a)(a,2),s=r[0],i=r[1],o=function(){var t=Object(b.a)(j.a.mark((function t(a){return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a.preventDefault(),e(E(s));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return!0===t.authenticated?Object(c.jsx)(l.a,{to:"/"}):Object(c.jsx)(w,{children:Object(c.jsx)(C,{children:Object(c.jsxs)("form",{onSubmit:o,className:"authForm",children:[Object(c.jsx)(I,{children:"SIGN UP"}),Object(c.jsx)(U,{type:"text",label:"First name",placeholder:"",onChange:function(e){return i(Object(u.a)(Object(u.a)({},s),{},{firstName:e}))}}),Object(c.jsx)(U,{type:"text",label:"Last name",placeholder:"",onChange:function(e){return i(Object(u.a)(Object(u.a)({},s),{},{lastName:e}))}}),Object(c.jsx)(U,{type:"text",label:"Email",placeholder:"",onChange:function(e){return i(Object(u.a)(Object(u.a)({},s),{},{email:e}))}}),Object(c.jsx)(U,{type:"password",label:"Password",placeholder:"",onChange:function(e){return i(Object(u.a)(Object(u.a)({},s),{},{password:e}))}}),t.error?Object(c.jsx)(R,{children:t.error}):Object(c.jsx)(c.Fragment,{}),Object(c.jsx)(A,{type:"submit",children:"SIGN UP"})]})})})}a(67);var k=function(){var e=Object(p.b)(),t=Object(p.c)((function(e){return e.auth})),a=Object(n.useState)({email:"",password:""}),r=Object(h.a)(a,2),s=r[0],i=r[1];return!0===t.authenticated?Object(c.jsx)(l.a,{to:"/"}):Object(c.jsx)(w,{children:Object(c.jsx)(C,{children:Object(c.jsxs)("form",{onSubmit:function(t){var a;t.preventDefault(),e((a=s,function(){var e=Object(b.a)(j.a.mark((function e(t){var c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t({type:"".concat(f,"_REQUEST")}),c=m.firestore(),m.auth().signInWithEmailAndPassword(a.email,a.password).then((function(e){c.collection("users").doc(e.user.uid).update({isOnline:!0}).then((function(){var a=e.user.displayName;a=a.split(" ");for(var c=new Array,n=0;n<a.length;n++)c.push(a[n]);var r={firstName:a[0],lastName:a[1],uid:e.user.uid,email:e.user.email};localStorage.setItem("user",JSON.stringify({user:r})),t({type:"".concat(f,"_SUCCESS"),payload:{user:r}})}))})).catch((function(e){t({type:"".concat(f,"_FAILURE"),payload:{error:e.message}})}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()))},className:"authForm",children:[Object(c.jsx)(I,{children:"Login"}),Object(c.jsx)(U,{type:"email",label:"Email",placeholder:"",onChange:function(e){return i(Object(u.a)(Object(u.a)({},s),{},{email:e}))}}),Object(c.jsx)(U,{type:"password",label:"Password",placeholder:"",onChange:function(e){return i(Object(u.a)(Object(u.a)({},s),{},{password:e}))}}),t.error?Object(c.jsx)(R,{children:t.error}):Object(c.jsx)(c.Fragment,{}),Object(c.jsx)(A,{type:"submit",children:"LOG IN"})]})})})},D=a.p+"static/media/mint.98ef681e.jpg",G=(a(68),a(21)),F=a(38),Q=a(42),B=a(39),P=function(){var e=Object(n.useState)(""),t=Object(h.a)(e,2),a=t[0],r=t[1],s=Object(n.useState)(""),i=Object(h.a)(s,2),o=i[0],l=i[1],d=Object(n.useState)(""),O=Object(h.a)(d,2),f=O[0],v=O[1],E=Object(p.b)(),_=Object(p.c)((function(e){return e.user})),U=_.users,C=_.conversations,R=_.loadingUser,T=_.loadingChat,k=_.lastestDoc,P=Object(p.c)((function(e){return e.auth})),M=function(){var e;E((e=P.uid,function(){var t=Object(b.a)(j.a.mark((function t(a){var c,n;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a({type:"".concat(x,"_REQUEST")}),c=m.firestore(),n=c.collection("users").where("uid","!=",e).onSnapshot((function(e){var t=[];e.forEach((function(e){e.data().length!=t.length&&t.push(e.data())})),a({type:"".concat(x,"_SUCCESS"),payload:{users:t}})})),t.abrupt("return",n);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()))};Object(n.useEffect)((function(){M()}),[]);var W=function(e){var t={uid_1:P.uid,uid_2:e.uid};E(function(e){var t=e.uid_1,a=e.uid_2;return function(){var e=Object(b.a)(j.a.mark((function e(c){var n,r,s,i;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c({type:"".concat(S,"_REQUEST")}),n=m.firestore(),r=n.collection("conversations").orderBy("createdAt","desc").limit(10).where("user_uid_1","in",[a,t]),e.next=5,r.get();case 5:s=e.sent,i=s.docs[s.docs.length-1],n.collection("conversations").orderBy("createdAt","desc").limit(10).where("user_uid_1","in",[a,t]).onSnapshot((function(e){var n=[];e.forEach((function(e){(e.data().user_uid_1==t&&e.data().user_uid_2==a||e.data().user_uid_1==a&&e.data().user_uid_2==t)&&n.push(e.data())})),c({type:"".concat(S,"_SUCCESS"),payload:{conversations:n,lastestDoc:i}})}));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}(t)),l(e)},J=function(e){e.preventDefault();var t={user_uid_1:P.uid,user_uid_2:o.uid,message:f};""!==f&&(E(function(e){return function(){var t=Object(b.a)(j.a.mark((function t(a){return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a({type:"".concat(N,"_REQUEST")}),m.firestore().collection("conversations").add(Object(u.a)(Object(u.a)({},e),{},{isView:!1,createdAt:new Date})).then((function(e){a({type:"".concat(N,"_SUCCESS")})})).catch((function(e){a({type:"".concat(N,"_REQUEST"),payload:{error:e.message}})}));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}(t)),v(""))},H=function(e){E(function(e){var t=e.uid_1,a=e.uid_2;return function(){var e=Object(b.a)(j.a.mark((function e(c){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c({type:"".concat(g,"_REQUEST")}),m.firestore().collection("conversations").where("user_uid_1","==",a).where("user_uid_2","==",t).orderBy("createdAt","desc").onSnapshot((function(e){e.forEach((function(e){e.ref.update({isView:!0})}))}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}({uid_1:P.uid,uid_2:o.uid}))};return Object(c.jsx)(w,{children:Object(c.jsxs)("div",{className:"homePage",children:[R?Object(c.jsx)("div",{className:"friendList loading",children:Object(c.jsx)(F.a,{className:"icon"})}):Object(c.jsx)("div",{className:"friendList",children:U.map((function(e,t){return Object(c.jsxs)("div",{onClick:function(){W(e),function(e){""!==a?(document.querySelectorAll(".friend")[a].classList.remove("isSelected"),document.querySelectorAll(".friend")[e].classList.add("isSelected"),r(e)):(document.querySelectorAll(".friend")[e].classList.add("isSelected"),r(e))}(t)},className:"friend",children:[Object(c.jsxs)("div",{className:"avatar",children:[Object(c.jsx)("img",{src:D,alt:"avatar"}),Object(c.jsx)("span",{className:e.isOnline?"isOnline":"isOffline"})]}),Object(c.jsxs)("div",{className:"friendState",children:[Object(c.jsx)("p",{className:"friendName",children:e.firstName+e.lastName}),Object(c.jsxs)("div",{className:"friendLastText",children:[Object(c.jsx)("p",{className:"lastText",children:"See you again "}),Object(c.jsx)("span",{}),Object(c.jsx)("p",{children:"4 hours ago"})]})]}),Object(c.jsx)("div",{className:"friendButton",children:Object(c.jsxs)("button",{children:[Object(c.jsx)("div",{className:"circle"}),Object(c.jsx)("div",{className:"circle"}),Object(c.jsx)("div",{className:"circle"})]})})]},t)}))}),""!==o?Object(c.jsxs)("div",{className:"chatBox",children:[Object(c.jsxs)("div",{className:"headBox",children:[Object(c.jsxs)("div",{className:"headUser",children:[Object(c.jsx)("img",{alt:"avatar",src:D}),Object(c.jsx)("p",{children:o.firstName})]}),Object(c.jsxs)("div",{className:"headCall",children:[Object(c.jsx)(G.e,{className:"icon"}),Object(c.jsx)(Q.a,{className:"icon"}),Object(c.jsx)(G.d,{className:"icon"})]})]}),T?Object(c.jsx)("div",{className:"chatArea loading",children:Object(c.jsx)(F.a,{className:"icon"})}):Object(c.jsx)("div",{onScroll:function(){var e=document.body,t=document.querySelector(".chatArea");if(0==(t=t.clientHeight?t:e).scrollTop){var a={uid_1:P.uid,uid_2:o.uid,lastestDoc:k};E(function(e){var t=e.uid_1,a=e.uid_2,c=e.lastestDoc;return function(){var e=Object(b.a)(j.a.mark((function e(n){var r,s,i,o;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n({type:"".concat(y,"_REQUEST")}),r=m.firestore(),s=r.collection("conversations").orderBy("createdAt","desc").where("user_uid_1","in",[a,t]).startAfter(c||0).limit(10),e.next=5,s.get();case 5:i=e.sent,c=i.docs[i.docs.length-1],o=[],i.docs.forEach((function(e){o.push(e.data())})),console.log(o),n(o!==[]?{type:"".concat(y,"_SUCCESS"),payload:{conversations:o.reverse(),lastestDoc:c}}:{type:"".concat(y,"_FAILURE"),payload:{error:"END"}});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}(a))}},className:"chatArea",children:Object(c.jsx)("div",{className:"chatAreaWrap",children:C.map((function(e,t){return Object(c.jsxs)("div",{className:P.uid==e.user_uid_1?"chatWrapper right":"chatWrapper left",children:[P.uid!==e.user_uid_1?Object(c.jsx)("img",{src:D}):Object(c.jsx)(c.Fragment,{}),Object(c.jsx)("p",{children:e.message},t),Object(c.jsx)(G.a,{className:P.uid!=e.user_uid_1||e.isView?"icon gone":"icon"})]})}))})}),Object(c.jsxs)("div",{className:"typeArea",children:[Object(c.jsxs)("div",{className:"action",children:[Object(c.jsx)(G.g,{className:"icon"}),Object(c.jsx)(G.f,{className:"icon"}),Object(c.jsx)(B.a,{className:"icon"}),Object(c.jsx)(G.b,{className:"icon"})]}),Object(c.jsxs)("div",{className:"input",children:[Object(c.jsx)("form",{onSubmit:J,children:Object(c.jsx)("input",{value:f,onClick:function(){return H()},onChange:function(e){return v(e.target.value)},type:"text",placeholder:"Aa"})}),Object(c.jsx)(B.a,{className:"icon"})]}),Object(c.jsx)("div",{className:"likeButton",children:""===f?Object(c.jsx)(G.c,{className:"icon"}):Object(c.jsx)(G.h,{onClick:J,className:"icon"})})]})]}):Object(c.jsxs)("div",{className:"chatBox unSelected",children:[Object(c.jsx)(L.b,{className:"bigIcon"}),Object(c.jsx)(I,{children:"Your Message"}),Object(c.jsx)("p",{children:"Send private photos and messages to a friend or group."}),Object(c.jsx)(A,{children:"Send a message"})]})]})})},M=a(44);function W(e){var t=e.component,a=Object(M.a)(e,["component"]);return Object(c.jsx)(l.b,Object(u.a)(Object(u.a)({},a),{},{component:function(e){return(localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")):null)?Object(c.jsx)(t,Object(u.a)({},e)):Object(c.jsx)(l.a,{to:"/login"})}}))}var J=function(){var e=Object(p.b)(),t=Object(p.c)((function(e){return e.auth}));r.a.useEffect((function(){t.authenticated||e(function(){var e=Object(b.a)(j.a.mark((function e(t){var a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")):null,t(a?{type:"".concat(f,"_SUCCESS"),payload:{user:a.user}}:{type:"".concat(f,"_FAILURE"),payload:{error:""}});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[]);var a=[{path:"/",name:"Home",component:P},{path:"/login",name:"Login",component:k},{path:"/signup",name:"Sign Up",component:T}];return Object(c.jsx)("div",{className:"App",children:Object(c.jsx)(o.a,{children:a.map((function(e){return Object(c.jsx)("div",{children:"Home"===e.name?Object(c.jsx)(W,{path:e.path,component:e.component,exact:!0}):Object(c.jsx)(l.b,{path:e.path,component:e.component})},e.name)}))})})},H=a(22),q={firstName:"",lastName:"",uid:"",email:"",authenticating:!1,authenticated:!1,error:null},V=a(40),z={users:[],conversations:[],loadingUser:!0,loadingChat:!0,lastestDoc:{}},Y=Object(H.c)({auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"".concat(f,"_REQUEST"):return e=Object(u.a)(Object(u.a)({},e),{},{authenticating:!0});case"".concat(f,"_SUCCESS"):return e=Object(u.a)(Object(u.a)({},e),{},{firstName:t.payload.user.firstName,lastName:t.payload.user.lastName,uid:t.payload.user.uid,email:t.payload.user.email,authenticated:!0,authenticating:!1,error:null});case"".concat(f,"_FAILURE"):return e=Object(u.a)(Object(u.a)({},e),{},{authenticated:!1,authenticating:!1,error:t.payload.error});case"".concat(v,"_REQUEST"):return e;case"".concat(v,"_SUCCESS"):return e=Object(u.a)({},q);case"".concat(v,"_FAILURE"):return e=Object(u.a)(Object(u.a)({},e),{},{error:t.payload.error});default:return e}},user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"".concat(x,"_REQUEST"):return e=Object(u.a)(Object(u.a)({},e),{},{loadingUser:!0});case"".concat(x,"_SUCCESS"):return e=Object(u.a)(Object(u.a)({},e),{},{loadingUser:!1,users:t.payload.users});case"".concat(S,"_REQUEST"):return e=Object(u.a)(Object(u.a)({},e),{},{loadingChat:!0});case"".concat(S,"_SUCCESS"):return e=Object(u.a)(Object(u.a)({},e),{},{loadingChat:!1,conversations:t.payload.conversations.reverse(),lastestDoc:t.payload.lastestDoc});case"".concat(y,"_REQUEST"):return e=Object(u.a)(Object(u.a)({},e),{},{loadingChat:!0});case"".concat(y,"_SUCCESS"):return e=Object(u.a)(Object(u.a)({},e),{},{loadingChat:!1,conversations:[].concat(Object(V.a)(t.payload.conversations),Object(V.a)(e.conversations)),lastestDoc:t.payload.lastestDoc});case"".concat(y,"_FAILURE"):return e=Object(u.a)({},e);default:return e}}}),K=a(43),Z=Object(H.d)(Y,Object(H.a)(K.a));window.store=Z,i.a.render(Object(c.jsx)(p.a,{store:Z,children:Object(c.jsx)(J,{})}),document.getElementById("root"))}},[[69,1,2]]]);
//# sourceMappingURL=main.2563fd08.chunk.js.map